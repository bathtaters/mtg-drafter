extends ../generic/layout

block header
  link(rel='stylesheet' href='/stylesheets/admin.css')
  
block scripts
    script(src='/javascripts/admin-panel-listeners.js')

mixin checkbox(itemId, labelText, isChecked=false, wrapper='dbCheckbox')
    div(class=wrapper)
        input(type='checkbox' id=itemId name=itemId checked=isChecked)
        label(for=itemId)= labelText

block content
    h1#panelTitle Admin Panel
    #userHeader
        span.infoLabel User:
        span.infoValue#headerUsername= user.current
        a.headerLink#logoutLink(href='logout') logout
        a.headerLink(href='../../' target='_blank') New Draft
    hr#headerDivider
    #panelWrapper

        //- Sessions box
        form#sessionsContainer.panelContainer(action='session' method='post')
            label.containerTitle(for='sessionId') Drafts
            select.panelSelect#sessionBox(name='sessionId' multiple=true)
                each session in sessionList
                    - var statusLine = session.status
                    if draftStatus.isIn(session.status)
                        - statusLine += '['+(session.round + 1)+']'
                    option(value=session.sessionId) #{session.date} #{statusLine} #{session.name.substr(0,25)}[#{session.playerCount}]
            .panelButtons
                input.button#sessionDetails(type='submit' value='Details' disabled='true')
                input.button#sessionDelete(type='button' value='Delete' disabled='true')
                input.button#sessionDisconnect(type='button' value='Disconnect' disabled='true')
            .panelButtons#clearContainer
                input.button#sessionClear(type='button' value='Clear')
                label.clearText(for='clearSessions') drafts older than
                input.smallInputBox#clearDays(type='number' name='clearDays' min=0 value=7)
                label.clearText(for='clearDays') days. 

        //- Sets box
        form#setsContainer.panelContainer(action='set' method='post')
            label.containerTitle(for='sets') Sets
            select.panelSelect#setsBox(name='sets' multiple=true)
                each set in sets
                    - var setTitle = set.name
                    if set.block
                        - setTitle += ' ('+set.block+')'
                    if set.cardCount
                        - var missing = set.cardCount - set.gatherer - set.scryfall
                        - setTitle += ' '+'['+set.gatherer+'/'+set.scryfall+(missing ? '/'+missing : '')+']'
                    if set.code == defaultSet
                        -setTitle += ' <d>'
                    option(class=(set.enabled ? 'setOn' : 'setOff') value=set.code)= setTitle + (set.enabled ? '' : ' <h>')
            .panelButtons
                input.button#setToggle(type='button' value='Toggle Visibility' disabled='true')
                input.button#setDefault(type='button' value='Make Default' disabled='true')
            .panelButtons#setsDefaultContainer
                input.button#setUpdate(type='button' value='Update All')
                input.button#setReset(type='button' value='Reset All')
                label.setsDefaultLabel(for='setsDefault') Visibility forced to:
                select.smallInputBox#setsDefault(name='setsDefault')
                    option(value=1 selected=true) On
                    option(value=0) Off

        //- MTG Database box
        form#dbContainer.panelContainer(action='updateDb' method='post')
            label.containerTitle(for='dbContainer') Update MtG Database
            .dbUrlLine
                label(for='setUrl') Sets: 
                input#setUrl(type='url' name='setUrl' value=url.set readonly=true)
                input.button#setEdit(type='button' value='Edit')
            .dbUrlLine
                label(for='setUrl') Cards: 
                input#cardUrl(type='url' name='cardUrl' value=url.card readonly=true)
                input.button#cardEdit(type='button' value='Edit')
            .dbCheckboxContainer
                +checkbox('updateSets', 'Update Set database', true)
                +checkbox('updateCards', 'Update Card database', true)
                +checkbox('fixCardAlts', 'Update alternate printings', true)
                +checkbox('skipCurrent', 'Only update if outdated', true)
            .updateButtonContainer
                input.button#updateDbButton(type='button' value='Update')
                #dbLoading.loading.hidden
            .resultText#dbResult
            #dbCountsContainer
                .inlineInfo
                    span.infoLabel Sets:
                    span.infoValue= dbCount.set
                .inlineInfo
                    span.infoLabel Cards:
                    span.infoValue= dbCount.card
        
        //- User Settings box
        .panelContainer#userContainer
            form#currentUserContainer.panelContainer(action='user' method='post')
                label.containerTitle(for='userContainer') Current User: #{user.current}
                .userLine
                    label(for='currentPassword') Old Password: 
                    input#currentPassword(type='password' name='currentPassword')
                    .buttonSpacer
                .userLine
                    label(for='newPassword') New Password:
                    input#newPassword(type='password' name='newPassword')
                    input.button#pwordEdit(type='button' value='Update')
                .resultText#currentUserResult

            if user.isSuper
                form#sudoContainer.panelContainer(action='user' method='post')
                    label.containerTitle(for='userBox') Other Users
                    #sudoList
                        select.panelSelect#userBox(name='userBox' multiple=true)
                            each username in user.list
                                if username != user.current
                                    option= username
                        div
                            input.button#userRemove(type='button' value='Remove' disabled='true')
                    #sudoAddUser
                        .sudoLine
                            label(for='addUsername') Username: 
                            input#addUsername(type='test' name='addUsername')
                            .buttonSpacer
                        .sudoLine
                            label(for='addPassword') Password:
                            input#addPassword(type='password' name='addPassword')
                            input.button#userAdd(type='button' value='Add')
                